<html>
        <head>
            <title>remote_control_cozmo.py display</title>
            <link type="text/css" rel="stylesheet" href="static/styles.css"/>
            <script src="static/dist/nipplejs.js" charset="utf-8"></script>
        </head>
        <body>
            <h1 style="text-align:center">Welcome to Cozmo World</h1>
            <div id="left"></div>
            <div id="right"></div>
            <table>
                <tr height=10></tr>
                <tr height=50>
                <td width=10></td>
                <td width=300></td>
                <td width=340></td>
                <td valign=top width=300>
                    <button class = "button" type="button" onClick="controlHead()">Control Head</button>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <button class = "button" type="button" onClick="controlLift()">Control Lift</button>
                </td>
                </tr>
                <tr>
                    <td width=10></td>
                    <td valign=top>
                        <h2>Control Movement</h2>
                    </td>
                    <td width=340></td>
                    <td valign=top>
                        <h2 id="headLiftText">Controlling Head</h2>
                    </td>
                </tr>
            </table>

            <script type="text/javascript">
                var gisControllingHead = true

                function controlLift() {
                    gisControllingHead = false;
                    document.getElementById('headLiftText').innerHTML = "Controlling Lift"
                }

                function controlHead() {
                    gisControllingHead = true;
                    document.getElementById('headLiftText').innerHTML = "Controlling Head"
                }

                var joystickL = nipplejs.create({
                    zone: document.getElementById('left'),
                    mode: 'static',
                    position: { left: '15%', top: '25%' },
                    color: 'orange',
                    size: 200
                });

                var joystickR = nipplejs.create({
                    zone: document.getElementById('right'),
                    mode: 'static',
                    position: { left: '60%', top: '25%' },
                    color: '#4CAF50',
                    size: 200
                });

                function doOnOrientationChange() {
                    
                    switch(window.orientation) 
                    {  
                      case -90:
                      case 90:
                      console.log("landscape");
                        var right = document.getElementById('nipple_1_1');
                        right.style.left = '80%';
                        right.style.top = '63%';
                        var left = document.getElementById('nipple_0_0');
                        left.style.left = '17%';
                        left.style.top = '63%';
                        break; 
                      default:
                      console.log("portrait");
                        var right = document.getElementById('nipple_1_1');
                        right.style.left = '80%';
                        right.style.top = '25%';
                        var left = document.getElementById('nipple_0_0');
                        left.style.left = '15%';
                        left.style.top = '25%';
                        break; 
                    }
                }

                  window.addEventListener('orientationchange', doOnOrientationChange);

                  // Initial execution if needed
                  doOnOrientationChange();

                function bindNipple () {
                    joystickR.on('end', function (evt, data) {
                        headLiftEnd(data);
                    }).on('move', function (evt, data) {
                        headLiftMove(data);
                    });

                    joystickL.on('start', function (evt, data) {
                        startJoystick(data);
                    }).on('end', function (evt, data) {
                        endJoystick(data);
                    }).on('move', function (evt, data) {
                        debug(data);
                    });
                }
                bindNipple();

                function headLiftEnd(obj) {
                    console.log("End");
                    msg = "End";
                    if(gisControllingHead) {
                        postHttpRequest("headEnd", {msg})
                    } else{
                        postHttpRequest("liftEnd", {msg})    
                    }
                }
                function headLiftMove (obj) {
                    angle = obj.angle.degree;
                    force = obj.force
                    console.log(angle);
                    console.log(force);
                    if(gisControllingHead) {
                        postHttpRequest("headMove", {angle,force})
                    } else{
                        postHttpRequest("liftMove", {angle,force})
                    }
                }

                function startJoystick(obj) {
                    console.log("Start");
                    msg = "Start";
                    postHttpRequest("joystickStart", {msg})
                }
                function endJoystick(obj) {
                    console.log("End");
                    msg = "End";
                    postHttpRequest("joystickEnd", {msg})
                }
                function debug (obj) {
                    angle = obj.angle.degree;
                    force = obj.force
                    console.log(angle);
                    console.log(force);
                    postHttpRequest("joystickMove", {angle,force})
                }

                function postHttpRequest(url, dataSet)
                {
                    var xhr = new XMLHttpRequest();
                    xhr.open("POST", url, true);
                    xhr.send( JSON.stringify( dataSet ) );
                }

                function updateCozmo()
                {
                    postHttpRequest("updateCozmo", {} )
                }
                setInterval(updateCozmo , 60);

                function handleKeyActivity (e, actionType)
                {
                    var keyCode  = (e.keyCode ? e.keyCode : e.which);
                    postHttpRequest(actionType, {keyCode})
                }

                document.addEventListener("keydown", function(e) { handleKeyActivity(e, "keydown") } );
                document.addEventListener("keyup", function(e) { handleKeyActivity(e, "keyup") } );

                function stopEventPropagation(event)
                {
                    if (event.stopPropagation)
                    {
                        event.stopPropagation();
                    }
                    else
                    {
                        event.cancelBubble = true
                    }
                }
            </script>

        </body>
    </html>